// jQuery isoSelective created by Alexander Buddy 'Gatsby' Jones http://www.gatsbyart.com
// update for jQuery 1.9+ by David Simmer http://simmerdesigns.com
function commonAncestor(e){var t=[];var n=Infinity;$(e).each(function(){var e=$(this).parents();t.push(e);n=Math.min(n,e.length)});for(var r in t){t[r]=t[r].slice(t[r].length-n)}for(var r in t[0]){var i=true;for(var s in t){if(t[s][r]!=t[0][r]){i=false;break}}if(i)return t[0][r]}return[]}(function(e){e.fn.isoSelective=function(t){var n=e.extend({},e.fn.isoSelective.defaults,t);return this.each(function(){$this=e(this);var t=e.meta?e.extend({},n,$this.data()):n;e.fn.isoSelective.initializeFiltering(t.linkSelector,t.attrSelector,t.activeClass,t.allowEmpty,$this)})};e.fn.isoSelective.initializeFiltering=function(t,r,s,o,u){var a=u;var f=new Array;var l=e(t).length;var c=e(t).get(0).tagName;var h=commonAncestor(t);for(i=0;i<l;i++){if(e(h).find(c).eq(i).hasClass(s)){f[i]=e(h).find(c).eq(i).attr(r)+", "}else{f[i]=" "}}if(f.indexOf("*, ")!=-1){var p=f.indexOf("*, ");for(g=0;g<f.length;g++){f[g]=""}f[p]="*"}e(t).on("click",function(){var i=e(this).attr(r);var u=e(h).find(c).index(this);if(e(this).attr(r)!="*"){var p=f.indexOf("*");if(p!=-1){f[p]="";e(h).find(c).eq(p).toggleClass(s)}if(f[u]==e(this).attr(r)+", "){f[u]=""}else{f[u]=e(this).attr(r)+", "}e(this).toggleClass(s)}else{if(f[u]=="*, "||f[u]=="*"){f[u]="";e(t).removeClass(s)}else{for(n=0;n<l;n++){f[n]=""}f[u]="*";e(t).removeClass(s);e(this).addClass(s)}}var d=f.join("");var v=d.replace(/\s/g,"");if(v!="*"){v=v.slice(0,-1)}if(v==""){if(o){v="#nulldiviwthoutapropername"}else{v="*"}}e(a).isotope({filter:v});return false})};e.fn.isoSelective.defaults={linkSelector:".filter",attrSelector:"rel",activeClass:"selected"}})(jQuery)